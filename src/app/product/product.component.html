<div class="container mt-4">
  <div class="row mb-3">
    <div class="col-md-4">
    </div>
    <div class="col-md-4 d-flex">
      <input
        type="date"
        class="form-control"
        [(ngModel)]="dateRange.start"
        (ngModelChange)="filterByDateRange()"
      />
      <input
        type="date"
        class="form-control ml-2"
        [(ngModel)]="dateRange.end"
        (ngModelChange)="filterByDateRange()"
      />
    </div>
  </div>
  <!-- Product table -->
  <table class="table table-bordered">
    <thead class="thead-dark">
      <tr>
        <th>Picture</th>
        <th (click)="sort('name')">Name</th>
        <th>Detail</th>
        <th (click)="sort('price')">Price</th>
        <th>Quantity</th>
        <th>Total Price</th>
        <th (click)="sort('createdDate')">
          Created Date
        </th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td></td>
        <td>
          <div class="col-md-12">
            <input
              type="text"
              class="form-control"
              placeholder="Search"
              [(ngModel)]="searchTerm"
              (ngModelChange)="filterProducts()"
            />
          </div>
        </td>
        <td>
          <div class="col-md-12">
            <input
              type="text"
              class="form-control"
              placeholder="Search"
              [(ngModel)]="searchTermDetails"
              (ngModelChange)="filterProductsDetails()"
            />
          </div>
        </td>
        <td>
          <div class="col-md-12">
            <input
              type="text"
              class="form-control"
              placeholder="Search"
              [(ngModel)]="searchTermPrice"
              (ngModelChange)="filterProductsPrice()"
            />
          </div>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr *ngFor="let product of displayedProducts">
        <td *ngIf="!product.editMode">
          <img
            [src]="product.picture"
            style="width: 50px"
            alt="Product Image"
            class="img-thumbnail"
          />
        </td>
        <td *ngIf="product.editMode">
          <input
            type="text"
            class="form-control"
            id="picture"
            name="picture"
            [(ngModel)]="newProduct.picture"
            required
          />
        </td>

        <td *ngIf="!product.editMode">{{ product.name }}</td>
        <td *ngIf="product.editMode">
          <input class="form-control" [(ngModel)]="product.name" required />
        </td>

        <td *ngIf="!product.editMode">{{ product.detail }}</td>
        <td *ngIf="product.editMode">
          <input class="form-control" [(ngModel)]="product.detail" required />
        </td>

        <td *ngIf="!product.editMode">{{ product.price }}</td>
        <td *ngIf="product.editMode">
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.price"
            required
          />
        </td>

        <td *ngIf="!product.editMode">{{ product.quantity }}</td>
        <td *ngIf="product.editMode">
          <input
            type="number"
            class="form-control"
            [(ngModel)]="product.quantity"
            required
          />
        </td>

        <td>{{ product.totalPrice }}</td>
        <td *ngIf="!product.editMode">
          {{ product.createdDate | date : "mediumDate" }}
        </td>
        <td *ngIf="product.editMode">
          <input
            type="date"
            class="form-control"
            [(ngModel)]="product.createdDate"
          />
        </td>

        <td>
          <button
            *ngIf="!product.editMode"
            class="btn btn-sm btn-primary mr-1"
            (click)="enableEdit(product)"
          >
            <i class="bi bi-pencil-fill"></i>
          </button>
          <button
            *ngIf="product.editMode"
            class="btn btn-sm btn-success mr-1"
            (click)="saveEdit(product)"
          >
            <i class="bi bi-check-circle-fill"></i>
          </button>
          <button
            class="btn btn-sm btn-danger"
            (click)="deleteProduct(product.id)"
          >
            <i class="bi bi-trash-fill"></i>
          </button>
        </td>
      </tr>
      <tr *ngIf="showform">
        <td>
          <input
            type="text"
            class="form-control"
            id="picture"
            name="picture"
            [(ngModel)]="newProduct.picture"
            required
          />
        </td>
        <!-- <td *ngIf="!product.editMode">{{ product.name }}</td> -->
        <td>
          <input class="form-control" [(ngModel)]="newProduct.name" required />
        </td>

        <!-- <td *ngIf="!product.editMode">{{ product.detail }}</td> -->
        <td>
          <input
            class="form-control"
            [(ngModel)]="newProduct.detail"
            required
          />
        </td>

        <!-- <td *ngIf="!product.editMode">{{ product.price }}</td> -->
        <td>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="newProduct.price"
            required
          />
        </td>

        <!-- <td *ngIf="!product.editMode">{{ product.quantity }}</td> -->
        <td>
          <input
            type="number"
            class="form-control"
            [(ngModel)]="newProduct.quantity"
            required
          />
        </td>

        <td>{{ newProduct.totalPrice }}</td>
        <!-- <td *ngIf="!product.editMode">{{ product.createdDate | date: 'mediumDate' }}</td> -->
        <td>
          <input
            type="date"
            class="form-control"
            [(ngModel)]="newProduct.createdDate"
          />
        </td>

        <td>
          <!-- <button *ngIf="!product.editMode" class="btn btn-sm btn-primary mr-1" (click)="enableEdit(product)">Edit</button> -->
          <button class="btn btn-sm btn-success mr-1" (click)="addNewProduct()">
            <i class="bi bi-check-circle-fill"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="showform = false">
            <i class="bi bi-trash-fill"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex w-100 justify-content-between">
    <nav aria-label="Page navigation">
      <ul class="pagination justify-content-center">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <button class="page-link" (click)="prevPage()" aria-label="Previous">
            <span aria-hidden="true">&laquo;</span>
            <span class="sr-only">Previous</span>
          </button>
        </li>
        <li
          class="page-item"
          *ngFor="let page of totalPagesArray"
          [class.active]="currentPage === page"
        >
          <button class="page-link" (click)="changePage(page)">
            {{ page }}
          </button>
        </li>
        <li class="page-item" [class.disabled]="currentPage === totalPages">
          <button class="page-link" (click)="nextPage()" aria-label="Next">
            <span aria-hidden="true">&raquo;</span>
            <span class="sr-only">Next</span>
          </button>
        </li>
      </ul>
    </nav>

    <button class="btn btn-primary" (click)="show()">Add Product</button>
  </div>
</div>
